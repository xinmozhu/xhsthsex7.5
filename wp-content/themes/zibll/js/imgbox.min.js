(function(e,t){"use strict";function i(i,s,a){function n(){u(),a.exclude&&(i+=":not("+a.exclude+")");var t=s?s+" "+i:i;s=!!a.group&&s,setTimeout(function(){c(i,s)},1e3),W.data("imgbox-ison-"+t)||(W.on("click",t,function(){var t=e(this);o(t,s)}),W.data("imgbox-ison-"+t,!0))}function o(t,i){var s=r(t,i);if(s.slide){e(I+" .swiper-imgbox .swiper-wrapper").html(s.slide),a.thumbs&&e(I+" .swiper-thumbsbox .swiper-wrapper").html(s.thumbs);var n=~~t.attr("imgbox-index")||0;setTimeout(function(){a.thumbs&&V.update(),L.update(),L.slideToLoop(n,10),L.autoplay.stop(),g(n,s.length),x()},10),z(t)}}function r(t,i){var s=t.data(j);if(s)return s;var a=i?e(t.parents(i)[0]):{};if(a.length){var n=a.data(j);if(n&&n.node_length==l(a))return n}return d(t,a)}function l(e){return e.find(i).length}function c(t,i){i?e(i).each(function(){var i=e(this);i.data(j)||d(i.find(t).eq(0),i)}):e(t).each(function(){var t=e(this);t.data(j)||d(t,{})})}function d(t,s){var n={slide:"",thumbs:"",length:0};if(s.length){var o=0;s.find(i).each(function(t){0==t&&(o=0);var i=e(this);q(i)||(i.attr("imgbox-index",o),n.slide+=S(i),n.length=o+1,a.thumbs&&(n.thumbs+=E(i)),o++)}),n.node_length=l(s),s.data(j,n)}else q(t)||t.find("img").length||(n.slide=S(t),n.length=o,t.data(j,n));return n}function u(){if(!O.length){var t='<div class="swiper-imgbox"><div class="swiper-wrapper"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-left counter-con"></div></div>',i='<div class="swiper-thumbsbox"><div class="swiper-wrapper"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-center right-top"><i class="hide-but fa fa-angle-down em12"></i></div></div>',s=a.down?'<a href="javascript:;" download class="img-down toggle-radius mr6" title="下载图片"><i class="fa fa-download"></i></a>':"";a.group&&(s+=a.play?'<a href="javascript:;" class="toggle-palay toggle-radius mr6" title="播放图片"><i class="fa fa-play"></i></a>':"",a.thumbs&&(s+='<a href="javascript:;" class="toggle-thumbs toggle-radius mr6" title="查看更多图片"><i class="fa fa-th-large"></i></a>',t+=i)),s+=a.zoom?'<a href="javascript:;" class="toggle-zoom toggle-radius mr6" title="切换图片缩放"><i class="fa fa-search"></i></a>':"",s+=a.full?'<a href="javascript:;" class="hide-sm toggle-full toggle-radius mr6" title="切换全屏"><i class="fa fa-expand"></i></a>':"",s+='<a href="javascript:;" title="关闭" class="icon-close toggle-radius"><svg viewBox="0 0 1024 1024" class="icon em12"><path d="M573.44 512.128l237.888 237.696a43.328 43.328 0 0 1 0 59.712 43.392 43.392 0 0 1-59.712 0L513.728 571.84 265.856 819.712a44.672 44.672 0 0 1-61.568 0 44.672 44.672 0 0 1 0-61.568L452.16 510.272 214.208 272.448a43.328 43.328 0 0 1 0-59.648 43.392 43.392 0 0 1 59.712 0l237.952 237.76 246.272-246.272a44.672 44.672 0 0 1 61.568 0 44.672 44.672 0 0 1 0 61.568L573.44 512.128z"></path></svg></a>',W.append('<div class="'+R+'" id="'+M+'"><div class="modal-backdrop imgbox-bg"></div><div class="imgbox-an">'+s+"</div>"+t+"</div>"),O=e(I),m(),f()}}function g(e,t){var i=O.find(".imgbox-an .toggle-palay");t>1?i.show():i.hide();var s=t>1?'<badge class="b-black counter">'+(e+1)+"/"+t+"</badge>":"";O.find(".counter-con").html(s)}function m(){var i=I+" .swiper-imgbox",s=~~((e(t).width()+800)/310),n={};n.speed=100*s,n.zoom={maxRatio:e(t).width()<768?3:2},n.autoplay={disableOnInteraction:!1},n.grabCursor=!0,n.navigation={nextEl:i+" .swiper-button-next",prevEl:i+" .swiper-button-prev"},n.keyboard={enabled:!0,onlyInViewport:!1},n.on={slideChange:function(){g(this.realIndex,this.slides.length)}},a.thumbs&&a.group&&(p(),n.thumbs={swiper:V,autoScrollOffset:~~(s/1.6)}),T.swiper=L=new Swiper(i,n)}function p(){var e=I+" .swiper-thumbsbox",t={watchSlidesVisibility:!0};t.navigation={nextEl:e+" .swiper-button-next",prevEl:e+" .swiper-button-prev"},t.slidesPerView="auto",t.freeMode=!0,t.freeModeSticky=!0,T.thumbs_swiper=V=new Swiper(e,t)}function f(){O.data("is_on")||(F(),O.on("click",".img-close,.imgbox-bg,.imgbox-an .icon-close",k),O.on("click",".imgbox-an .toggle-thumbs,.hide-but",function(){O.toggleClass("show-thumb")}),O.on("click",".imgbox-an .img-down",function(){var t=e(this),i=O.find(".swiper-imgbox .swiper-slide-active img"),s=i.attr("data-src")||i.attr("src"),a=s.substring(s.lastIndexOf("/")+1)||s;t.attr("href",s).attr("download",a)}),O.on("click",".imgbox-an .toggle-palay",function(){var t=e(this);t.hasClass("is-play")?L.autoplay.stop():L.autoplay.start(),t.toggleClass("is-play")}),O.on("click",".imgbox-an .toggle-zoom",function(){var t=e(this);L.zoom.toggle(),t.toggleClass("is-zoom")}),O.on("click",".imgbox-an .toggle-full",function(){document.fullscreenElement?v():h()}),O.data("is_on",!0))}function h(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen(),e(I+" .imgbox-an .toggle-full .fa").removeClass("fa-expand").addClass("fa-compress"),e(I+".show").addClass("full-screen")}function v(){document.fullscreenElement&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()),e(I+" .imgbox-an .toggle-full .fa").removeClass("fa-compress").addClass("fa-expand"),O.removeClass("full-screen")}function b(e){return-1==e.indexOf("base64,")&&e.length<300?e.replace(/(.*\/)(.*)(-\d+x\d+\.)(.*)/g,"$1$2.$4").replace(/\??x-oss-process(.*)/,""):e}function w(t){var i=t.offset(),s=i.top,a=i.left,n=e(document).scrollTop(),o=t.height(),r=t.width(),l=s-n+o/2,c=a+r/2;O.attr("style","--imgbox-origin-top:"+l+"px;--imgbox-origin-left:"+c+"px;")}function x(){var t=e(I+" .imgbox-an .toggle-thumbs,.hide-but");a.thumbs&&t.length&&(L.slides.length>1?t.show():(O.removeClass("show-thumb"),t.hide()))}function y(){var e=t.innerWidth;if(!e){var i=document.documentElement.getBoundingClientRect();e=i.right-Math.abs(i.left)}return document.body.clientWidth<e}function C(){var e=W.data("scrollbar-width");if(void 0!==e)return e;var t=document.createElement("div");t.className="modal-scrollbar-measure",W.append(t);var i=t.offsetWidth-t.clientWidth;return W[0].removeChild(t),W.data("scrollbar-width",i),i}function _(){var t=parseInt(W.css("padding-right")||0,10),i=C();y()&&(W.css("padding-right",t+i),$.each(function(t,s){var a=s.style.paddingRight,n=e(s).css("padding-right");e(s).data("padding-right",a).css("transition","none").css("padding-right",parseFloat(n)+i+"px")}))}function z(e){_(),W.addClass("imgbox-show"),w(e),O.addClass("show").removeClass("hide")}function k(){W.removeClass("imgbox-show").css("padding-right",""),$.css("padding-right",""),setTimeout(function(){$.css("transition","")},10),O.addClass("hideing").removeClass("show"),v(),setTimeout(function(){O.removeClass("hideing").addClass("hide").attr("style",""),e(".toggle-palay.is-play").removeClass("is-play");try{L.zoom.out(),L.autoplay.stop()}catch(e){console.log(e)}e(I+" .swiper-close").css({opacity:"",transform:""})},200)}function F(){O.on("touchmove pointermove MSPointerMove",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}),O.minitouch({direction:"bottom",selector:".swiper-close",depreciation:100,onStart:!1,stop:function(e,t){var i=t.find("img").css("transform").replace(/[^0-9\-,]/g,"").split(",")[0];return i&&i>1},onIng:function(e,t,i,s){var a=(200-s)/100;a=a<1&&a,t.css("opacity",a)},inEnd:function(e,t,i,s){s<=50&&t.css({opacity:""})},onEnd:function(e,t,i,s){k(),t.css({transform:"translateY("+(s+200)+"px)"})}})}function S(e){var t=e.attr("src")||e.attr("box-img"),i=e.attr("data-src");if(!t&&!i)return"";var s=e.attr("data-full-url")||b(i||t),a=t==s?'<img src="'+s+'" class="lazyloaded">':'<img src="'+t+'" data-src="'+s+'"  class="lazyload"><div class="swiper-lazy-preloader"></div>',n='<div class="swiper-slide"><div class="swiper-close"><div class="swiper-zoom-container"><div class="absolute img-close"></div>'+a+"</div></div></div>";return n}function E(e){var t=e.attr("data-src")||e.attr("src");if(!t)return"";var i='<img data-src="'+t+'"  class="lazyload fit-cover">',s='<div class="swiper-slide">'+i+"</div>";return s}function q(e){var t=e.attr("data-src")||e.attr("src");if(!t)return!1;t=b(t);var i=e.parent("a");if(!i.length)return!1;var s=i.attr("box-img")||i.attr("href");return s=b(s),s&&(-1==s.indexOf(t)||-1==t.indexOf(s))}var R="mini-imgbox imgbox",M="mini-imgbox",j="imgbox_data",I="#"+M,O=e(I),T=t.Miniimgbox,L=T.swiper,V=T.thumbs_swiper,W=e("body"),$=e(".nav-fixed header");a.group||(a.thumbs=!1),n()}var s=function(e,t){return i(e,t,s.options)};s.options={group:!0,thumbs:!0,down:!0,play:!0,zoom:!0,full:!0,exclude:".no-imgbox,.avatar,.img-icon,.avatar-badge,.smilie-icon"},s.swiper="",s.thumbs_swiper="",t.Miniimgbox=s,tbquire(["swiper"],function(){e("link#swiper").length||e("head").append('<link type="text/css" id="swiper" rel="stylesheet" href="'+_win.uri+"/css/swiper.min.css?ver="+_win.ver+'">'),s.options.group="group"===_win.imgbox_type,s.options.thumbs=_win.imgbox_thumbs,s.options.down=_win.imgbox_down,s.options.play=_win.imgbox_play,s.options.zoom=_win.imgbox_zoom,s.options.full=_win.imgbox_full,s(".alone-imgbox-img,a[data-imgbox]"),s("img",".wp-posts-content"),s("img",".imgbox-container"),s(".box-img",".comment-content")})})(jQuery,window);