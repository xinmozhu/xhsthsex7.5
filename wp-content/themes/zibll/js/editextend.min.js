(function(t,i){function e(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}tbquire=i.tbquire||function(){};var a=i.zib=i.zib||{},n=i._win=i._win||{};a.ajax_url=a.ajax_url||n.ajax_url,a.user_upload_nonce=a.user_upload_nonce||n.user_upload_nonce,a.is_split_upload=a.is_split_upload||n.is_split_upload||0,a.split_minimum_size=a.split_minimum_size||n.split_minimum_size||10,n.is_split_upload&&tbquire(["spark-md5"]),a.media=function(e){function s(t){var i={image:"image/gif,image/jpeg,image/jpg,image/png,image/bmp",video:"video/*",audio:"audio/*",file:"*"};return i[t]}function l(t,i){if(t.msg){var e=t.ys?t.ys:t.error?"danger":"";i.notify(t.msg,e)}}function o(t,i){var e="操作失败 "+t.status+" "+t.statusText+"，请刷新页面后重试";t.responseText&&t.responseText.indexOf("致命错误")>-1&&(e="网站遇到致命错误，请检查插件冲突或通过错误日志排除错误"),console.error("ajax请求错误，错误信息如下：",t),i.notify(e,"danger")}function d(i){return d.onprogress=i,function(){var i=t.ajaxSettings.xhr();return i.upload&&(i.upload.onprogress=d.onprogress),i}}function c(t){t.addClass("notyn-out");var e=t.data("notice_this_id");setTimeout(function(){t.remove(),i.notice_ing[e]=!1},3e3)}this.file_data={},this.upload_ing={},this.new_upload=[],this.active_lists=[],this.input_lists=[],this.option=t.extend({iframe:!0,search:!0,is_upload:!1,is_input:!0,upload_multiple:!1,upload_size:30,upload_ext:"",multiple:0,text:{},is_split_upload:!1,split_minimum_size:20,split_chunk_size:2,is_breakpoint:!0},e),this.type_names={image:"图片",video:"视频",audio:"音频",file:"附件"},this.type=this.option.type||"image",this.type_name=this.type_names[this.type],this.refresh_lists=!0,this.ajax_url=a.ajax_url,this.upload_nonce=a.user_upload_nonce,this.upload_action="user_upload",this.split_upload_action="user_split_upload",this.split_upload_merge_action="user_split_upload_merge",this.split_uploaded_chunk_action="user_split_uploaded_chunk",void 0!==a.is_split_upload&&(this.option.is_split_upload=a.is_split_upload),a.split_minimum_size>=4&&(this.option.split_minimum_size=~~a.split_minimum_size);var r="upload_ing";return this.init=function(){this.initDOM()},this.getMy=function(){var t=this.option;if(t.is_upload){var i=t.text.upload_title||"最大支持"+t.upload_size+"M"+(t.upload_multiple>1?"，单次可上传"+t.upload_multiple+"个文件":"")+"，支持拖文件上传",e=t.search?'<div class="relative"><input class="form-control search-input" type="text" placeholder="搜索" name="search" class="form-control"><div class="abs-right muted-3-color"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"></use></svg></div></div>':"",a='<input class="upload-input" style="display: none;" '+(1!=t.upload_multiple?' multiple="multiple"':"")+' type="file" accept="'+s(this.type)+'">',n='<div class="flex0 flex ac"><i data-toggle="tooltip" title="'+i+'" class="muted-2-color mr10 fa fa-question-circle-o"></i><label style="margin: 0;">'+a+'<botton class="nowave but c-blue upload-btn" type="button"><i aria-hidden="true" class="fa fa-cloud-upload"></i>上传</botton></label></div>',l='<div class="my-header box-body"><div class="flex ac jsb">'+e+n+"</div></div>";return'<div class="mini-media-my-box">'+l+'<div class="type-'+this.type+' notop box-body mini-media-my-lists mini-scrollbar scroll-y max-vh5"></div><div class="modal-buts but-average"><a style="display: none;" class="but c-blue my-submit" href="javascript:;">确 认</a></div><div class="drop-mask">拖拽文件至此以上传</div></div>'}},this.getInput=function(){if(this.option.is_input){var t=1!=this.option.multiple,i=this.option.text.input_title||"请填写"+this.type_name+"地址"+(t?"，支持批量输入，一行一个链接":"：");return'<div class="box-body input-input-box"><p>'+i+'</p><textarea autoheight="true" maxheight="200" tabindex="1" class="form-control input-input" style="min-height:84px;" placeholder="https://..."></textarea></div><div class="modal-buts but-average"><a class="but c-blue input-submit" href="javascript:;">确 认</a></div>'}},this.getIframe=function(){return'<div class="box-body iframe-input-box"><p>请输入嵌入地址或者直接粘贴iframe嵌入代码：</p><textarea autoheight="true" maxheight="200" tabindex="1" class="iframe-input form-control input-textarea" style="min-height:84px;" placeholder="&lt;iframe src=&quot;https://....&quot;&gt;&lt;/iframe&gt;"></textarea></div><div class="modal-buts but-average"><a class="but c-blue iframe-submit" href="javascript:;">确认嵌入</a></div>'},this.createContent=function(){var t=this.option.text.title?'<div class="font-bold modal-title">'+this.option.text.title+"</div>":"",i=this.option.text.subtitle?'<div class="em09 mt6 muted-2-color">'+this.option.text.subtitle+"</div>":"",e=i||t?'<div class="ml20 mt20" style="margin-right: 40px;">'+t+i+"</div>":"",a="",n=this.getInput(),s=this.getMy(),l=[];switch(this.type){case"image":s&&l.push({btn:"我的图片",con:s}),n&&l.push({btn:"外链图片",con:n});break;case"video":s&&l.push({btn:"我的视频",con:s}),n&&l.push({btn:"外链视频",con:n}),this.option.iframe&&l.push({btn:"嵌入视频",con:this.getIframe()});break;case"file":s&&l.push({btn:"我的文件",con:s}),n&&l.push({btn:"输入地址",con:n})}return a=this.createTab(l),e+a},this.initDOM=function(){if(!this.$el){var e=this;e.this_id=e.getRandom();var a="mini-media-modal-"+e.this_id,n=e.createContent(),s=t(i).width()<768,l='<div class="modal flex jc fade mini-media-modal'+(s?" bottom":"")+'" id="'+a+'" tabindex="-1" role="dialog" aria-hidden="false" style="display: none;">            <div class="modal-mini full-sm modal-dialog" role="document">            <div class="modal-content"><button data-dismiss="modal" class="mr10 mt10 close"><svg class="ic-close" aria-hidden="true"><use xlink:href="#icon-close"></use></svg></button><div class="mini-media-content">'+n+"</div></div>"+(s?'<div class="touch-close"></div>':"")+"            </div>            </div>";t("body").append(l),e.$el=t("#"+a),e.$content=t("#"+a+" .mini-media-content"),e.$mylists=t("#"+a+" .mini-media-my-lists"),s&&e.$el.on("show.bs.modal",function(){var i=t(this);i.minitouch({direction:"bottom",selector:".modal-dialog",start_selector:".touch-close",onEnd:function(){i.modal("hide")}})}),e.$el.on("hidden.bs.modal",function(){e.$mylists.find(".list-item.upload-ing").length&&e.notify("继续上传中，请勿刷新页面","warning")}),e.$content.on("click","a[next-paged]",function(i){i.preventDefault();var a=t(this),n=~~a.attr("next-paged");return a.prop("outerHTML",'<a><i class="loading mr10"></i>加载中</a>'),e.loadLists(n),!1}),e.$content.on("change",".upload-input",function(i){i.preventDefault();var a=this.files||i.dataTransfer.files;if(!a||!a.length)return!1;e.uploadChange(t(this),a)});var o,d,c="drag-over",r=".mini-media-my-box";e.$content.on("dragover dragenter",r,function(i){i.preventDefault(),i.stopPropagation(),o&&clearTimeout(o),d||t(this).addClass(c)}),e.$content.on("dragleave",r,function(i){i.preventDefault(),i.stopPropagation();var e=t(this);o=setTimeout(function(){d=!1,e.removeClass(c)},10)}),e.$content.on("drop",r,function(i){i.preventDefault(),i.stopPropagation(),t(this).removeClass(c);var a=i.originalEvent.dataTransfer.files;if(!a||!a.length)return!1;e.uploadChange(t(this),a)}),e.$content.on("input",".search-input",e.debounce(function(i){i.preventDefault(),e.searchChange(t(this))},600)),e.$content.on("click",".search-close",function(){if(t(this).attr("disabled"))return!1;var i=e.$content.find(".search-input");i.val(""),e.searchChange(i)}),e.$mylists.on("click",".list-item:not(.upload-ing)",function(){e.activeLists(t(this))}),e.$content.on("click",".my-submit",function(){var t=e.getListData(e.active_lists);e.$el.trigger("select_submit").trigger("lists_submit",{data:t,ids:e.active_lists}),e.close()}),e.$content.on("click",".input-submit",function(){var t=e.$content.find(".input-input"),i=e.enCode(t.val());if(!i)return e.notify("请输入"+e.type_name+"地址","warning");var a=e.option.multiple;i=i.split(/[(\r\n)\r\n]+/),i.forEach((t,e)=>{t||i.splice(e,1)}),a&&i.length>a&&e.notify("最多可输入"+a+"个"+e.type_name+"地址","warning"),e.setInputVals(i),e.$el.trigger("select_submit").trigger("input_submit",{vals:i}),e.close()}),e.$content.on("click",".iframe-submit",function(){var i=e.$content.find(".iframe-input"),a=i.val(),n=t.parseHTML(a);a=t(n).attr("src")||e.enCode(a),e.setIframeVal(a),e.$el.trigger("select_submit").trigger("iframe_submit",e.iframe_data),e.close()})}},this.resetIframeVal=function(){this.setIframeVal()},this.setIframeVal=function(t,i){this.iframe_data={src:t||"",ratio:i||56},this.$content.find(".iframe-input").val(this.iframe_data.src||"")},this.resetInputVals=function(){this.setInputVals([])},this.setInputVals=function(t){var i=this.option.multiple;i>0&&t.splice(i,t.length+1),this.input_lists=t,this.$content.find(".input-input").val(t.join("\n"))},this.resetActiveLists=function(){this.setActiveLists([])},this.setActiveLists=function(t){this.active_lists=t;var i="active",e="active-index",a=this.option.multiple,n=1==a;this.$mylists.find(".list-item."+i).removeClass(i).find("."+e).remove();for(let a in t)this.$mylists.find('.list-item[data-file-id="'+t[a]+'"]').addClass(i).append('<div class="'+e+'">'+(n?'<i class="fa fa-check em09"></i>':1+~~a)+"</div>");var s=this.$mylists.find(".list-item:not(."+i+")");a>1&&t.length>=a?s.attr("disabled",!0):s.attr("disabled",!1);var l=this.$content.find(".my-submit");t.length&&!n?l.show():l.hide(),n&&t.length&&l.click()},this.activeLists=function(t){var i=~~t.attr("data-file-id");if(i&&!t.attr("disabled")){var e=1==this.option.multiple?[]:this.active_lists,a="active-index",n=t.find("."+a);if(n.length){var s=~~n.html()-1;e.splice(s,1)}else e.push(i);this.setActiveLists(e)}},this.getListData=function(i){t.isArray(i)||(i=[i]);var e=[];for(let t in i){var a=i[t];this.file_data[a]&&e.push(this.file_data[a])}return e},this.getSelectUrl=function(){this.active_lists},this.searchChange=function(i){var e=t.trim(i.val()),a=i.siblings(".abs-right"),n="limit-warning",s='<div class="'+n+' top">至少输入两个字符</div>',l='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"></use></svg>',o='<i class="loading em12"></i>';if(i.siblings("."+n).remove(),a.html(l),e){if(e.length<2)return void i.after(s)}else this.new_upload=[];e&&a.html(o),this.search_val=e,this.loadLists()},this.createTab=function(t,i){var e="",a="";i=i||"main";var n=0;for(let s in t){n++;let l=this.this_id+"-tab-"+i+"-"+s;e+="<li"+(0==s?' class="active"':"")+'><a href="#'+l+'" data-toggle="tab">'+t[s].btn+"</a></li>",a+='<div class="tab-pane fade'+(0==s?" in active":"")+'" id="'+l+'">'+t[s].con+"</div>"}return(n>1?'<ul class="mt20 text-center list-inline tab-nav-theme">'+e+"</ul>":this.option.text.subtitle||this.option.text.title?"":'<div style="margin: 35px;"></div>')+'<div class="tab-content">'+a+"</div>"},this.ajax=function(i,e,a){var n=this;t.ajax({type:"POST",url:this.ajax_url,data:i,dataType:"json",error:function(i){o(i,n),t.isFunction(a)&&a(i)},success:function(t){l(t,n),e(t)}})},this.getFileExt=function(t){return t.substring(t.lastIndexOf(".")+1)},this.createImageList=function(t){return'<img src="'+(t.thumbnail_url||"")+'" data-full-url="'+(t.url||"")+'" alt="'+(t.title||this.type)+'">'},this.createVideoList=function(t){var i=t.filename||t.name,e=t.fileLength?'<i class="fa fa-play-circle-o mr3"></i>'+t.fileLength:"",a=t.filesizeInBytes?'<i class=""></i>'+this.formatSize(t.filesizeInBytes):"";return a=a||'<i class=""></i>'+this.formatSize(t.size),'<div class="px12 flex1 flex xx padding-6 padding-h6"><div class="px12 text-ellipsis-2"><i class="fa fa-file-video-o mr6"></i>'+i+'</div><div class="flex1 flex ab jsb muted-2-color"><span class="">'+e+'</span><span class="">'+a+"</span></div></div>"},this.createList=function(t,i){var e;switch(this.type){case"image":e=this.createImageList(t);break;case"video":e=this.createVideoList(t);break;default:var a=t.filename||t.name,n=this.getFileExt(a),s=t.filesizeInBytes?this.formatSize(t.filesizeInBytes):"",l='<div class="list-item-icon-box flex jc" ><i class="fa fa-file-text-o em12"></i></div>';switch(t.type){case"video":l='<div class="list-item-icon-box flex jc" ><i class="fa fa-file-video-o em12"></i></div>';break;case"image":l='<div style="padding-bottom: 100%!important;border-radius: 4px;" class="graphic "><img class="fit-cover" src="'+(t.thumbnail_url||t.url)+'" alt="'+(t.title||"image")+'"></div>'}e='<div class="px12 flex1 flex xx padding-6 padding-h6"><div class="flex ac"><div class="mr6 flex0"><div style="width: 33px;">'+l+'</div></div><div class="text-ellipsis-2">'+a+'</div></div><div class="flex1 flex ab jsb muted-2-color"><span class="">'+n+'</span><span class="">'+s+"</span></div></div>"}return'<div class="'+(i?i+" ":"")+'list-item" data-file-id="'+(t.id||0)+'" data-file-type="'+this.type+'"><div class="list-box">'+e+"</div></div>"},this.createLists=function(i){var e="",a=this;return i&&t.each(i,function(t,i){e+=a.createList(i),a.file_data[i.id]=i}),e},this.loadLists=function(t,i){var e=this;if(e.$mylists&&e.$mylists.length){var a="loading-box";t=t||1;var n=e.$mylists,s='<div style="height: 140px;width: 100%;" class="flex jc loading-box"><div class="em14 opacity5"><i class="loading"></i></div></div>';i=i||{},i.action="current_user_attachments",i.type=e.type,i.paged=t,e.search_val&&(i.search=e.search_val),1==t?n.html(s):i.exclude=e.new_upload,e.ajax(i,function(s){var l="null-box",o="theme-pagination",d="";s.lists&&(d=e.createLists(s.lists)),d&&s.all_pages>t&&(d+='<div class="text-center '+o+'" all-count="'+s.all_count+'" all-pages="'+s.all_pages+'"><div class="ajax-next"><a href="" next-paged="'+(t+1)+'"><i class="fa fa-angle-right"></i>加载更多</a></div></div>');var c=n.find(".list-item").last();if(n.find("."+o+",."+l+",."+a).remove(),c.length?c.after(d):(d=d||'<div class="flex1 opacity5 flex jc '+l+'" style="height: 140px;">暂无相应内容</div>',n.html(d)),i.search){var r='<a class="search-close" href="#"><svg aria-hidden="true"><use xlink:href="#icon-close"></use></svg></a>';e.$content.find(".search-input+.abs-right").html(r)}e.refresh_lists=!1})}},this.uploadBeforeDOM=function(t){var i=this.$mylists,e=i.find(".list-item").first();i.find(".null-box").remove(),e.length?e.before(t):i.prepend(t)},this.getFileMd5=function(t,i){tbquire(["spark-md5"],function(){var e=new FileReader;e.onload=function(t){var e=t.target.result,a=new SparkMD5.ArrayBuffer;a.append(e);var n=a.end();i(n)},e.readAsArrayBuffer(t)},function(){i("")})},this.uploadFile=function(i,e,a){function n(){delete x.upload_ing[w],D.remove(),0==Object.keys(x.upload_ing).length&&(e.data(r,!1).attr("disabled",!1),O.attr("disabled",!1),A.attr("disabled",!1))}function s(){n(),m("error"),a.css({"box-shadow":"0 0 2px 2px #ff372c"}),setTimeout(function(){a.remove()},2e3)}function c(t){if(!t.id)return!1;m("success"),x.file_data[t.id]=t,x.new_upload.push(t.id),setTimeout(function(){a.prop("outerHTML",x.createList(t)),n(),x.$el.trigger("upload",t)},400)}function u(t){return q["chunk_"+t]}function p(t,i){q["chunk_"+t]=i}function f(i){t.isPlainObject(i)||(i={}),q=i}function m(t,i){if(i=i||k,t=t||0,"success"==t)return I.html("已上传").css({background:"rgb(92, 184, 92)"}),M.css("width","100%");if("error"==t)return I.html("上传失败").css({background:"rgba(255, 55, 44, 0.8)",bottom:0}),M.css("width","100%");var e=t/i*100;T&&(i=k,e=(S+t)/i*100),e>B&&(B=e,e=i>10485760?e.toFixed(1):e.toFixed(0),I.find("text").html(e>=100?"处理中":e+"%"),M.css("width",e+"%"))}function v(t){return j++,C=L,L=C+$,E||Object.keys(q).length!==z?j<z&&(g(t),!0):(S=k,m(),b())}function h(t){var e=new FormData;if(e.append("_wpnonce",x.upload_nonce),e.append("file_type",x.type),e.append("file_size",k),e.append("file_name",i.name),T){var a=i.slice(C,L);e.append("action",x.split_upload_action),e.append("split_chunks_count",z),e.append("split_current_chunk",j),e.append("split_chunk_size",x.option.split_chunk_size),e.append("file",a),x.option.is_breakpoint&&u(j)?x.getFileMd5(a,function(i){e.append("chunk_md5",i),t(e)}):t(e)}else e.append("file",i,i.name),e.append("action",x.upload_action),t(e)}function _(){var t={action:x.split_uploaded_chunk_action,file_name:i.name,split_chunks_count:z,_wpnonce:x.upload_nonce};x.ajax(t,function(t){f(t.uploaded_chunks),g()},s)}function b(){var t={action:x.split_upload_merge_action,file_type:x.type,file_size:k,file_name:i.name,split_chunks_count:z,uploaded_chunks:JSON.stringify(q),_wpnonce:x.upload_nonce};E=!0,x.ajax(t,function(t){return l(t,x),t.error?s():t.chunk_loss?(B=0,S=t.progress,m(),f(t.uploaded_chunks),j=0,C=0,L=$,P=1,E=!1,g()):t.id?c(t):s()},s)}function g(i){h(function(e){if(T&&x.option.is_breakpoint){var a=u(e.get("split_current_chunk"));if(a&&a===e.get("chunk_md5"))return S+=$,v(),m()}T&&P<F&&(setTimeout(function(){v(P)},50*P),P++);var n=0;t.ajax({type:"POST",url:x.ajax_url,data:e,processData:!1,contentType:!1,dataType:"json",error:function(t){return o(t,x),s()},xhr:d(function(t){S+=t.loaded-n,n=t.loaded,m(T?0:t.loaded,t.total)}),success:function(t){if(l(t,x),t.error)return s();if(t.id)c(t);else{if(!T)return s();t.file_md5&&p(t.current_chunk,t.file_md5),t.uploaded_size?S=t.uploaded_size:S+=$,m(),v(i)}return!1}})})}function y(){T&&x.option.is_breakpoint&&z>2?_():g()}var x=this,w=x.getRandom(),k=i.size,$=1024*x.option.split_chunk_size*1024,z=Math.ceil(k/$),j=0,C=0,L=$,T=i.slice&&x.option.is_split_upload&&k>1048567*x.option.split_minimum_size&&z>1,I=a.find(".progress-text"),D=a.find(".progress"),M=a.find(".progress .progress-bar"),O=x.$content.find(".search-input"),A=x.$content.find(".search-close"),q={},B=0,S=0,E=!1,F=4,P=1;e.data(r,!0).attr("disabled",!0),O.attr("disabled",!0),A.attr("disabled",!0),I.html('<i class="loading mr6"></i><text>准备中</text>'),x.upload_ing[w]=!0,y()},this.uploadChange=function(i,e){var a=this,n=a.option.upload_multiple,s=1!=n,l=a.option.upload_size;if(!e[0]||i.data(r))return!1;for(var o='<div class="progress progress-striped active progress-abs-bottom"><div class="progress-bar progress-bar-success"></div></div><div class="progress-text abs-center conter-bottom">准备中...</div>',d=1,c=0;c<e.length&&(s||!(d>1));c++){if(s&&n&&d>n){a.notify("单次最多可上传"+n+"个内容","warning");break}var u=e[c];if("file"===a.type||-1!=u.type.indexOf(a.type)){var p=a.option.upload_ext;if(p){p="|"+p+"|";var f="|"+a.getFileExt(u.name)+"|";if(-1==p.indexOf(f)){a.notify("不允许上传此格式文件","danger");continue}}if(u.size>1048567*l)a.notify("文件["+u.name+"]大小超过限制，最大"+l+"M","warning");else{var m=t(a.createList(u,"upload-ing"));m.append(o),"image"===a.type&&a.setImgPreview(u,m),a.uploadBeforeDOM(m),a.uploadFile(u,i,m),d++}}else a.notify("不允许上传此格式文件","danger")}},this.getRandom=function(){return parseInt((Math.random()+1)*Math.pow(10,4))},this.setImgPreview=function(t,i){var e=new FileReader;e.readAsDataURL(t),e.onload=function(e){i.find("img").attr({alt:t.name,src:e.target.result})}},this.enCode=function(i){return t("<div />").html(t.trim(i)).text()},this.formatSize=function(t,i,e){var a;for(e=e||["B","K","M","G","TB"];(a=e.shift())&&t>1024;)t/=1024;return("B"===a?t:t.toFixed(void 0===i?1:i))+a},this.debounce=function(t,i,e){var a;return function(){var n=this,s=arguments,l=function(){a=null,e||t.apply(n,s)},o=e&&!a;clearTimeout(a),a=setTimeout(l,i),o&&t.apply(n,s)}},this.notify=function(e,a,s,l){var o=e+a+l;if(!i.notice_ing||!i.notice_ing[o]){i.notice_ing=i.notice_ing||{},i.notice_ing[o]=!0,t(".notyn").length||n.bd.append('<div class="notyn"></div>'),a=a||"success",s=s||5e3,s=s<100?1e3*s:s;var d=l?' id="'+l+'"':"",r=t('<div class="noty1"'+d+'><div class="notyf '+a+'">'+e+"</div></div>");r.data("notice_this_id",o);var u=!l;l&&t("#"+l).length?(t("#"+l).find(".notyf").removeClass().addClass("notyf "+a).html(e),r=t("#"+l),u=!0):t(".notyn").append(r),u&&setTimeout(function(){c(r)},s)}},this.open=function(){this.$el.modal("show"),this.refresh_lists&&this.loadLists()},this.close=function(){this.$el.modal("hide")},this.init(),this},t.fn.PayDawnloadEdit=function(){function e(e){function s(){if(!p){var e="pay-dawnload-edit-modal",s=t(i).width()<768,l='<div class="mb20"><b class="modal-title flex ac"><span class="toggle-radius mr10 b-theme"><i class="fa fa-download"></i></span><span class="pay-download-title">添加资源</span></b></div>',v='<div class="mb20"><div class="muted-color mb6">下载地址</div><div class="flex ac"><input type="text" class="form-control" tabindex="1" value="" name="link" placeholder="请输入下载地址"><botton type="button" class="flex0 ml6 pay-upload-btn but hollow c-blue"><i class="fa fa-upload"></i>上传文件</botton></div></div>';v+='<div class="mb20"><div class="muted-color mb6">资源备注</div><input type="text" class="form-control" tabindex="1" value="" name="more" placeholder="请输入更多内容"><div class="px12 muted-3-color mt6">显示在下载按钮旁边的内容，建议为提取码、解压密码等</div></div>',v+='<div class="mb20"><div class="muted-color mb6">点击复制</div><div class="flex ac"><input type="text" tabindex="1" value="" name="copy_key" class="form-control mr10" placeholder="复制名称"><input type="text" class="form-control" tabindex="1" value="" name="copy_val" placeholder="复制内容"></div><div class="px12 muted-3-color mt6">为“资源备注”按钮添加点击复制功能，建议为提取码、解压密码等</div></div>',v+='<div class="mb6"><div class="muted-color mb6">个性化下载按钮</div><div class="flex ac"><input type="text" tabindex="1" value="" name="name" class="form-control mr10" placeholder="自定义按钮名称"></div></div>';var h=["c-red","c-yellow","c-cyan","c-blue","c-green","c-purple","b-red","b-yellow","b-cyan","b-blue","b-green","b-purple","jb-red","jb-pink","jb-yellow","jb-cyan","jb-blue","jb-green","jb-purple","jb-vip1","jb-vip2"],_='<botton type="button" class="class-choice badg b-theme" data-val=""></botton>';h.map(function(t){_+='<botton type="button" class="class-choice badg '+t+'" data-val="'+t+'"></botton>'}),v+='<div class="mb20"><div class="muted-2-color mb6 px12">选择按钮风格</div><div class="flex ac hh">'+_+'</div><input type="hidden" name="class" value=""></div>';var b=l+'<div class="mini-scrollbar scroll-y max-vh7" style="padding:0 3px;">'+v+'</div><div class="modal-buts but-average"><a class="but c-blue pay-dawnload-submit" href="javascript:;">确 认</a></div>',g='<div class="modal flex jc fade pay-dawnload-edit-modal'+(s?" bottom":"")+'" id="'+e+'" tabindex="-1" role="dialog" aria-hidden="false" style="display: none;"><div class="modal-mini full-sm modal-dialog" role="document"><div class="modal-content"><button data-dismiss="modal" class="mr10 mt10 close"><svg class="ic-close" aria-hidden="true"><use xlink:href="#icon-close"></use></svg></button><div class="pay-dawnload-edit-content modal-body">'+b+"</div></div>"+(s?'<div class="touch-close"></div>':"")+"</div></div>";t("body").append(g),p=t("#"+e),f=t("#"+e+" .pay-dawnload-edit-content"),s&&p.on("show.bs.modal",function(){var i=t(this);i.minitouch({direction:"bottom",selector:".modal-dialog",start_selector:".touch-close",onEnd:function(){i.modal("hide")}})});var y={type:"file",is_upload:!0,is_input:!1,upload_multiple:1,upload_size:n.upload_file_size||30,upload_ext:n.upload_ext||"",multiple:1,text:{input_title:"",title:"请选择或上传附件"}},x=new a.media(y);x.$el.on("lists_submit upload",function(t,i){i=i.data?i.data[0]:i,x.close(),i.url&&(f.find('[name="link"]').val(i.url),u())}),p.on("input",'[name="link"]',u),p.on("click",".pay-dawnload-submit",function(){o()}),p.on("click",".pay-upload-btn",function(){x.resetActiveLists(),x.open()}),p.on("click",".class-choice",function(){r(t(this).attr("data-val"))}),m.on("click",".pay-dawnload-add",function(){p.data("edit_lists",!1),c({})}),m.on("click",".pay-dawnload-add-edit",function(){var i={},e=t(this).parent();e.find("[data-depend-id]").each(function(){var e=t(this),a=e.attr("data-depend-id");i[a]=e.val()}),p.data("edit_lists",e),c(i)}),m.on("click",".pay-dawnload-add-delete",function(){t(t(this).parents(".lists-item")[0]).remove(),d()})}}function l(i){return i=t.trim(i.replace(/<[^<>]+?>/g,"")),0==i.length?"":(i=i.replace(/</g,"&lt;"),i=i.replace(/>/g,"&gt;"),i=i.replace(/'/g,"&#39;"),i=i.replace(/"/g,"&quot;"),i)}function o(){var i={};if(t.each(["link","more","name","copy_key","copy_val","class"],function(t,e){i[e]=l(f.find('[name="'+e+'"]').val())}),i.link){var e=p.data("edit_lists");e||(e=t('<div class="flex ac jsb lists-item"><a href="javascript:;" class="flex1 name-link pay-dawnload-add-edit"></a><a href="javascript:;" class="pay-dawnload-add-delete em12 ml10 hollow but cir c-red"><i title="fa fa-trash-o" class="fa fa-trash-o"></i></a><div class="hidden-input"></div></div>'),v.append(e)),t.each(i,function(t,i){var a=e.find('[data-depend-id="'+t+'"]');a.length?a.val(i):e.find(".hidden-input").append('<input type="hidden" data-depend-id="'+t+'" value="'+i+'">')}),e.find(".name-link").html(i.link),d(),p.modal("hide")}}function d(){var i="posts_zibpay[pay_download]";v.find(".lists-item").each(function(e){t(this).find("[data-depend-id]").each(function(){var a=t(this);a.attr("name",i+"["+e+"]["+a.attr("data-depend-id")+"]")})})}function c(i){i=t.extend({link:"",more:"",name:"",class:"",copy_key:"",copy_val:""},i);var e=i.link?"编辑资源":"添加资源";f.find(".pay-download-title").text(e),t.each(i,function(t,i){f.find('[name="'+t+'"]').val(i)}),u(),r(i.class),p.modal("show")}function r(t){t=t||"",f.find('[name="class"]').val(t),f.find('.class-choice[data-val="'+t+'"]').addClass("is-active").siblings().removeClass("is-active")}function u(){var t=f.find(".modal-buts");l(f.find('[name="link"]').val())?t.show():t.hide()}var p,f,m=t(e),v=m.find(".lists-box");s()}return this.each(function(){var i=t(this),a=i.data("pay_dawnload_data");a||i.data("pay_dawnload_data",new e(t(this)))})},tbquire(["main"],function(){t(".pay-dawnload-edit").PayDawnloadEdit()}),t.fn.featuredEdit=function(){function i(i){function s(i){var e=p+"-box",a=p+"-btns",n=p+"-input",s='<div class="'+e+'"></div><div class="'+a+'"></div><div class="hide '+n+'"></div>';i.$el.html(s),i.$con=i.$el.find("."+e),i.$btn=i.$el.find("."+a),i.$input=i.$el.find("."+n);var r=l(i.$el);r.options&&(i.options=t.extend(i.options,r.options)),u(i),r.data&&("video"===r.type?o(r.data,i):"slide"===r.type?d(r.data,i):c(r.data,i)),i.is_init=!0}function l(t){var i=t.attr("featured-args");try{i=JSON.parse(i)}catch(t){}return t.removeAttr("featured-args"),i}function o(i,a){var n=a.data,s=n.data||{};i.pic?s.pic=i.pic:!s.pic&&"image"==n.type&&s.url&&(s.pic=s.url),n.type="video",s.url=i.url||s.url||"",n.data=s;var l=~~a.options.video_ratio,o=t('<div class="new-dplayer '+(l?" dplayer-scale-height":"")+'" video-url="'+s.url+'" video-pic="'+s.pic+'"'+(l?'  style="--scale-height:'+l+'%;"':"")+'><div class="graphic" style="padding-bottom:'+l+'%;"><div class="abs-center text-center"><i class="fa fa-play-circle fa-4x muted-3-color opacity5" aria-hidden="true"></i></div></div></div>');a.data=n,a.$con.html(o),a.$el.addClass(p+"-loaded video"),e(a,"image"),e(a,"video_pic"),get_new_dplayer(o)}function d(i,a){var n="",s=[];t.each(i,function(t,i){var e=i.url;s.push(i.id),n+='<div class="swiper-slide"><img src="'+e+'" alt="封面幻灯片"></div>'});var l='<div class="new-swiper scale-height" data-loop="true" data-autoplay="true" data-interval="2000" style="--scale-height:'+a.options.slide_ratio+'%"><div class="swiper-wrapper">'+n+'</div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="swiper-pagination"></div></div>',o={type:"slide",data:{ids:s}};a.data=o,a.$con.html(l),a.$el.addClass(p+"-loaded slide"),e(a,"video"),new_swiper()}function c(t,i){var a=t.url,n='<div class="graphic" style="padding-bottom:'+i.options.image_ratio+'%;"><img class="fit-cover" src="'+a+'" alt="图片封面"></div>',s={type:"image",data:{url:a,id:t.id||0}};i.data=s,i.$con.html(n),i.$el.addClass(p+"-loaded image"),e(i,"video")}function r(t){var i={type:"close"};t.data=i,t.$el.removeClass(p+"-loaded image slide video"),t.$con.html(""),t.media.image.resetActiveLists(),t.media.video&&t.media.video.resetActiveLists(),e(t,"video"),e(t,"image")}function u(t){var i="",e=t.options,n="btn-video",s="btn-video-pic",l="btn-image",u="btn-delete";i+='<botton type="button" class="but cir '+l+'" title="图像" data-toggle="tooltip"><i class="em09 fa fa-camera"></i></botton>',i+=e.video?'<botton type="button" class="but cir '+s+'" title="设置视频首图封面" data-toggle="tooltip"><i class="em09 fa fa-image"></i></botton>':"",i+=e.video?'<botton type="button" class="but cir '+n+'" title="视频" data-toggle="tooltip"><i class="em09 fa fa-video-camera"></i></botton>':"",i+='<botton type="button" class="but cir '+u+'" title="移除" data-toggle="tooltip"><i class="em09 fa fa-trash"></i></botton>';var p='<div class="btns-full flex jc">'+i+"</div>";t.$btn.html(p),t.media=t.media||{};var f={type:"image",is_upload:!0,upload_multiple:1,upload_size:e.image_upload_size,multiple:1,text:{input_title:"请填写图片地址：",title:"为视频设置首图封面"}},m=t.media.video_pic=new a.media(f);if(t.$el.on("click","."+s,function(){m.open()}),m.$el.on("lists_submit upload",function(i,e){m.close();var a=e.data?e.data[0]:e;o({pic:a.url},t)}),m.$el.on("input_submit",function(i,e){o({pic:e.vals[0]},t)}),e.video){var v={type:"video",is_upload:!0,iframe:!1,upload_multiple:1,upload_size:e.video_upload_size,multiple:1},h=t.media.video=new a.media(v);t.$el.on("click","."+n,function(){h.open()}),h.$el.on("lists_submit upload",function(i,e){h.close();var a=e.data?e.data[0]:e;o(a,t),t.data.data&&t.data.data.pic||m.open()}),h.$el.on("input_submit",function(i,e){o({url:e.vals[0]},t)})}var _={type:"image",is_upload:!0,upload_multiple:e.slide?e.image_upload_multiple:1,upload_size:e.image_upload_size,multiple:e.slide?30:1,text:{input_title:"请填写图片地址："}},b=t.media.image=new a.media(_);t.$el.on("click","."+l,function(){b.open()}),b.$el.on("lists_submit",function(i,e){var a=e.data;a.length>1?d(a,t):c(a[0],t)}),b.$el.on("input_submit",function(i,e){c({url:e.vals[0]},t)}),t.$el.on("click","."+u,function(){r(t)})}this.$el=t(i),this.options={video:!0,slide:!0,video_ratio:46,slide_ratio:46,image_ratio:50,video_upload_size:n.upload_video_size||30,image_upload_size:n.upload_img_size||4,image_upload_multiple:~~n.img_upload_multiple||6},this.data={};var p="featured";this.is_init||s(this)}function e(t,i){var e=t.media[i];e&&(e.resetActiveLists(),e.resetInputVals())}return this.each(function(){var e=t(this),a=e.data("featured_data");a||e.data("featured_data",new i(t(this)))})},tbquire(["main"],function(){t(".featured-edit").featuredEdit()});var s=tinymce.PluginManager.add;s("zib_hide",function(i){function e(e){var n={payshow:"付费阅读",vip1:"会员可查看",logged:"登录后可查看",reply:"评论后查看"},s=i.selection.getNode(),l=t.trim(i.selection.getContent())||"",o="<p></p>";if(l="<p>"+l+"</p>",a(s))o="",l=t(s).find('[contenteditable="true"]').html();else if("P"===s.nodeName){var d=t.trim(s.outerHTML);d&&(i.dom.remove(s),l=d)}i.insertContent('<div class="tinymce-hide" contenteditable="false"><p class="hide-before">[hidecontent type="'+e+'" desc="隐藏内容：'+n[e]+'"]</p><div contenteditable="true">'+l+'</div><p class="hide-after">[/hidecontent]</p></div>'+o)}function a(t){return"tinymce-hide"===t.className}var n=[{text:"评论后可查看",onclick:function(){e("reply")}},{text:"登录后可查看",onclick:function(){e("logged")}},{text:"会员可查看",onclick:function(){e("vip1")}}];mce.hide_pay&&n.push({text:"付费后可查看",onclick:function(t){e("payshow",t)}}),i.addButton("zib_hide",{text:"",icon:"preview",tooltip:"隐藏内容",type:"menubutton",stateSelector:".tinymce-hide",menu:n}),i.on("wptoolbar",function(t){a(t.element)&&i.wp&&(t.toolbar=i.wp._createToolbar(["zib_hide","dom_remove"],!0))})}),s("zib_quote",function(i){function e(e){var n=t.trim(i.selection.getContent())||"",s="<p></p>";n="<p>"+n+"</p>";var l=i.selection.getNode();if(a(l))s="",n=t(l).find('[contenteditable="true"]').html();else if("P"===l.nodeName){var o=t.trim(l.outerHTML);o&&(i.dom.remove(l),n=o)}i.insertContent('<div class="quote_q quote-mce '+e+'" contenteditable="false"><div contenteditable="true">'+n+"</div></div>"+s)}function a(i){return t(i).hasClass("quote_q")}i.on("init",function(){function t(){!0==!i.settings.readonly&&s.hide(),i.execCommand("mceFocus",!1)}function e(){""==i.getContent()?s.show():s.hide()}function a(){s.hide()}let s=new n;e(),tinymce.DOM.bind(s.el,"click",t),i.on("focus",t),i.on("blur",e),i.on("change",e),i.on("setContent",e),i.on("keydown",a)});let n=function(){let t=i.getElement().getAttribute("placeholder")||i.settings.placeholder||"请输入内容",e=i.settings.placeholder_attrs||{style:{
position:"absolute",top:this.get_top(),left:0,color:"rgba(136, 136, 136, 0.6)",padding:"1%",width:"98%",overflow:"hidden","white-space":"pre-wrap","font-size":"16px"}},a=i.getContentAreaContainer();this.el=tinymce.DOM.add(a,i.settings.placeholder_tag||"label",e,t)};n.prototype.get_top=function(){return tinymce.DOM.$(i.getContainer()).find(".mce-top-part")[0].clientHeight+11},n.prototype.hide=function(){tinymce.DOM.setStyle(this.el,"display","none")},n.prototype.show=function(){tinymce.DOM.setStyle(this.el,"display",""),tinymce.DOM.setStyle(this.el,"top",this.get_top())},i.addButton("zib_quote",{text:"",icon:"blockquote",tooltip:"引言",type:"menubutton",menu:[{text:"灰色",onclick:function(){e("")}},{text:"红色",onclick:function(){e("qe_wzk_c-red")}},{text:"蓝色",onclick:function(){e("qe_wzk_lan")}},{text:"绿色",onclick:function(){e("qe_wzk_lv")}}]}),i.on("wptoolbar",function(t){a(t.element)&&i.wp&&(t.toolbar=i.wp._createToolbar(["zib_quote","dom_remove"],!0))})}),s("zib_file",function(t){function i(t){return t.substring(t.lastIndexOf(".")+1)}function s(i,e,a,n,s,l){if(i||e){a=a||"请输入文件名称",n=n||"";var o=s||l?'<div class="mt10"><div class="flex ab jsb muted-2-color file-download-desc em09"><div class="desc-left">'+s+'</div><div class="desc-right">'+l+"</div></div></div>":"";e=e||"javascript:;",i=i?'data-download-file="'+i+'"':"";var d="<p></p>",c='<div class="mb20 muted-box file-download-box" contenteditable="false"><div class="flex ac jsb">            <div class="flex ac">            <div class="mr10"><div class="file-download-icon">'+n+'</div></div>    <div class="text-ellipsis-2 file-download-name" contenteditable="true">'+a+'</div>        </div>            <div class="flex0 ml20">                <a href="'+e+'" data-mce-href="'+e+'" '+i+' class="but c-blue file-download-btn"><i class="fa fa-download"></i>下载</a>            </div>        </div>        '+o+"</div>";t.insertContent(c+d)}}function l(){d.open(),d.resetActiveLists(),d.resetInputVals()}var o={type:"file",is_upload:!0,is_input:!0,upload_multiple:1,upload_size:n.upload_file_size||30,upload_ext:n.upload_ext||"",multiple:1,text:{}},d=new a.media(o);d.$el.on("lists_submit upload",function(t,e){d.close();var a=e.data?e.data[0]:e,n=a.filename||a.name,l=i(n)+"文件",o=a.filesizeInBytes?d.formatSize(a.filesizeInBytes):"",c="";"image"===a.type&&a.thumbnail_url&&(c='<img class="fit-cover no-imgbox" src="'+a.thumbnail_url+'" alt="下载图标">'),s(a.id,"",n,c,l,o)}),d.$el.on("input_submit",function(t,i){i.vals&&i.vals[0]&&s(0,i.vals[0])}),t.addButton("zib_file",{text:"",icon:"upload",tooltip:"附件",onclick:function(){e()||l()},onTouchEnd:function(){e()&&l()}})}),s("zib_img",function(s){function l(){c.open()}function o(t,i,e,a){var n=e?' data-edit-file-id="'+e+'"':"",s=a?' alt="'+a+'"':"",l=i?' data-full-url="'+i+'"':"";return'<p><img src="'+t+'"'+n+s+l+"></p>"}var d={type:"image",is_upload:mce.img_allow_upload,upload_multiple:~~n.img_upload_multiple,upload_size:n.upload_img_size||4,multiple:100},c=new a.media(d);c.$el.on("lists_submit",function(t,i){var e=i.data,a="";for(let t in e){var n=e[t].url,l=e[t].large_url;a+=o(l,n,e[t].id,e[t].title)}s.insertContent(a+"<p></p>"),c.resetActiveLists()}),c.$el.on("upload",function(t,i){c.active_lists.push(i.id),c.setActiveLists(c.active_lists)}),c.$el.on("input_submit",function(t,i){var e=i.vals,a="";for(let t in e)a+=o(e[t]);s.insertContent(a+"<p></p>"),c.resetInputVals()}),mce.img_allow_upload&&s.on("paste",function(e){var a=(e.clipboardData||i.clipboardData).files;a[0]&&a[0].type&&-1!==a[0].type.indexOf("image")&&(e.preventDefault(),c.open(),c.resetActiveLists(),c.uploadChange(t(this),a))}),s.addButton("zib_img",{text:"",icon:"image",tooltip:"图片",onclick:function(){e()||l()},onTouchEnd:function(){e()&&l()}})}),s("zib_video",function(t){function i(){o.open()}function s(i,e,a){var n=' data-video-url="'+i+'"';n+=' data-video-name="'+(e||i)+'"',n+=a?' data-edit-file-id="'+a+'"':"",t.insertContent('<div contenteditable="false"'+n+' class="new-dplayer post-dplayer dplayer"></div><p></p>')}var l={type:"video",is_upload:mce.video_allow_upload,iframe:mce.video_allow_iframe,upload_multiple:1,upload_size:n.upload_video_size||30,multiple:1},o=new a.media(l);o.$el.on("lists_submit upload",function(t,i){o.close();var e=i.data?i.data[0]:i;s(e.url,e.filename,e.id),o.resetActiveLists()}),o.$el.on("input_submit",function(t,i){s(i.vals[0]),o.resetInputVals()}),o.$el.on("iframe_submit",function(i,e){t.insertContent('<div contenteditable="false" class="wp-block-embed is-type-video mb20"><div class="iframe-absbox" style="padding-bottom:'+(e.ratio||56)+'%;"><iframe src="'+e.src+'" allowfullscreen="allowfullscreen" framespacing="0" border="0" width="100%" frameborder="no"></iframe></div></div><p></p>'),o.resetIframeVal()}),t.addButton("zib_video",{text:"",tooltip:"视频",icon:"media",onclick:function(){e()||i()},onTouchEnd:function(){e()&&i()}})})})(jQuery,window);